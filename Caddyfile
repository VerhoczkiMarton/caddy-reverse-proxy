{
    admin off
    persist_config off
    auto_https off
    log {
        format json
    }
    servers {
        trusted_proxies static private_ranges
    }
}

:{$PORT} {
    log {
        format json
    }

    # Handle API requests
    handle /api/* {
        reverse_proxy http://{$BACKEND_DOMAIN}:{$BACKEND_PORT} {
            header_up Host {http.reverse_proxy.upstream.hostport}
            transport http {
                dial_timeout 5s
                tls_insecure_skip_verify
            }
        }
    }

    # Handle frontend requests
    handle {
        reverse_proxy http://{$FRONTEND_DOMAIN}:{$FRONTEND_PORT} {
            header_up Host {http.reverse_proxy.upstream.hostport}
            transport http {
                dial_timeout 5s
                tls_insecure_skip_verify
            }
        }
    }
}
